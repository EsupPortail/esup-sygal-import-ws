11d10
<     'apogee' as code,
22,23d20
<     'apogee'            as source_id,       -- Id de la source
<     cod_vap             as id,
26,28c23
<     par_vap,
<     to_date('2017-01-01', 'YYYY-MM-DD') as DATE_DEB_VALIDITE,
<     to_date('9999-12-31', 'YYYY-MM-DD') as DATE_FIN_VALIDITE
---
>     par_vap
35,65c30
<   )
<   union all
<   select
<     'apogee' as source_id,
<     'EMAIL_ASSISTANCE' as id,
<     'EMAIL_ASSISTANCE' as cod_vap,
<     'Adresse mail de l''assistance utilisateur' as lib_vap,
<     'assistance-sygal@unicaen.fr' as par_vap,
<     to_date('2017-01-01', 'YYYY-MM-DD') as DATE_DEB_VALIDITE,
<     to_date('9999-12-31', 'YYYY-MM-DD') as DATE_FIN_VALIDITE
<   from dual
<   union all
<   select
<     'apogee' as source_id,
<     'EMAIL_BU' as id,
<     'EMAIL_BU' as cod_vap,
<     'Adresse mail de contact de la BU' as lib_vap,
<     'scd.theses@unicaen.fr' as par_vap,
<     to_date('2017-01-01', 'YYYY-MM-DD') as DATE_DEB_VALIDITE,
<     to_date('9999-12-31', 'YYYY-MM-DD') as DATE_FIN_VALIDITE
<   from dual
<   union all
<   select
<     'apogee' as source_id,
<     'EMAIL_BDD' as id,
<     'EMAIL_BDD' as cod_vap,
<     'Adresse mail de contact du bureau des doctorats' as lib_vap,
<     'recherche.doctorat@unicaen.fr' as par_vap,
<     to_date('2017-01-01', 'YYYY-MM-DD') as DATE_DEB_VALIDITE,
<     to_date('9999-12-31', 'YYYY-MM-DD') as DATE_FIN_VALIDITE
<   from dual;
---
>   );
75c40
<     to_char(ind.cod_etu)                                as id,              -- Numero etudiant
---
>     ind.cod_etu                                         as id,              -- Numero etudiant
79c44
<     initcap(coalesce(ind.lib_pr1_ind,'Aucun'))          as lib_pr1_ind,     -- Prenom 1 etudiant
---
>     initcap(ind.lib_pr1_ind)                            as lib_pr1_ind,     -- Prenom 1 etudiant
82c47
<     null as email,--ucbn_ldap.etu2mail ( ind.cod_etu )                  as email,           -- Mail etudiant
---
>     ucbn_ldap.etu2mail ( ind.cod_etu )                  as email,           -- Mail etudiant
96d60
<         and ind.cod_etu is not null         -- oui, oui, ça arrive
99c63
<   select "SOURCE_ID","TYPE","ID","CIV","LIB_NOM_USU_IND","LIB_NOM_PAT_IND","LIB_PR1_IND","LIB_PR2_IND","LIB_PR3_IND","EMAIL","DATE_NAI_IND","COD_PAY_NAT","LIB_NAT" from (
---
>   select * from (
157,158c121,122
<       coalesce(regexp_replace(per.num_dos_har_per,'[^0-9]',''), 'COD_PER_'||act.cod_per)                      as id,     -- Code Harpege ou Apogee de l acteur
<       --act.cod_per                                                                                             as id,     -- Code Apogee de l acteur
---
>       --coalesce(regexp_replace(per.num_dos_har_per,'[^0-9]',''), 'COD_PER_'||act.cod_per)                      as id,     -- Code Harpege ou Apogee de l acteur
>       act.cod_per                                                                                             as id,     -- Code Apogee de l acteur
166c130
<       null as email,--case when per.num_dos_har_per is null then null else ucbn_ldap.uid2mail ('p'||per.num_dos_har_per) end  as email,           -- Mail acteur
---
>       case when per.num_dos_har_per is null then null else ucbn_ldap.uid2mail ('p'||per.num_dos_har_per) end  as email,           -- Mail acteur
197,198c161
<     ind.cod_etu                                         as id,            -- Identifiant du doctorant
<     ind.cod_etu                                         as individu_id    -- Identifiant de l'individu
---
>     ind.cod_etu                                         as id              -- Numero etudiant
218d180
<         and cod_etu is not null         -- oui, oui, ça arrive
262c224
<     ind.cod_etu                     doctorant_id,     -- Identifiant du doctorant
---
>     ind.cod_etu as individu_id,              -- Numero etudiant
435d396
<     rownum                                                                        as id,
438c399
<     roj.cod_roj                                                                   as role_id,       -- Identifiant du rôle
---
>     roj.cod_roj                                                                   as role_id,       -- Code du role de l acteur
441c402,403
<     coalesce(regexp_replace(per.num_dos_har_per,'[^0-9]',''), 'COD_PER_'||act.cod_per) as individu_id, -- Code Harpege ou Apogee de l acteur
---
>     act.cod_per                                                                   as individu_id,   -- Code Apogee de l acteur
>     --regexp_replace ( per.num_dos_har_per, '[^0-9]', '' )                          as uid_per,       -- uid de l acteur
